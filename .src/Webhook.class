' Gambas class file

Public Const Version As Float = 0.3 ' TODO: Erhöhen der zahl je änderung der Klasse

Private $name As String
Private $Action As String[]
Private $checkID As Boolean
Private $Version As Float ' TODO: Erhöhen der zahl je änderung der Klasse
Private $keywordList As String[]
Private $Active As Boolean

Property Name As String
Property Action As String[]
Property Read CheckID As Boolean
Property Read keyWordList As String[]
Property Read Active As Boolean

Private Sub loadconf(Path As String)
  
  Dim sInput As String
  
  Dim hSettings As Settings
  
  hSettings = New Settings(User.home &/ ".webhook/" & Path)
  $name = hSettings["Webhook/Name"] 
  $Version = CFloat(hSettings["Webhook/Version"])
  $checkID = hSettings["Webhook/checkID"]
  $Action = Split(hSettings["Webhook/Action"], "|")
  $keywordList = Split(hSettings["Webhook/KeyWordList"], "|")
  $Active = hSettings["Webhook/Enable", 0]
  If $Version < Webhook.Version Then updateConf()
  
End

Private Sub updateConf()
  
  Dim hSettings As Settings
  
  hSettings = New Settings(User.home &/ ".webhook/" & $name & ".conf")
  
  Select $Version ''Check Version
      
    Case 0 To 0.1
      Main.Print("Update " & $name & " to V 0.2")
      $keywordList = ["test"]
      $Version = 0.2
      saveToConf()
    Case 0 To 0.2
      Main.Print("Update " & $name & " to V 0.3")
      $Version = 0.3
      $Active = True
      saveToConf()
    Case Else 
      Print "No Update " & Me.Name & " Version Up to date"
  End Select
  
End

Public Sub saveToConf() As Boolean
  
  Dim hSettings As Settings
  
  hSettings = New Settings(User.home &/ ".webhook/" & $name & ".conf")
  hSettings["Webhook/Name"] = $name
  hSettings["Webhook/checkID"] = $checkID
  hSettings["Webhook/Action"] = $Action.Join("|")
  hSettings["Webhook/Version"] = CStr($Version)
  hSettings["Webhook/KeyWordList"] = $keywordList.Join("|")
  hSettings["Webhook/Enable"] = $Active
  hSettings.Save()
  Return True
Catch 
  Return False
  
End

Public Sub _new(Name As String, CheckID As Boolean, Optional nameIsPath As Boolean, Optional Action As String[], Optional Key As String[])
  
  If nameIsPath Then 
    
    loadconf(name)
    
  Else 
    $name = name
    $checkID = CheckID
    $Action = Action
    $keywordList = Key
    $Active = True
    
    $Version = Version  
    
  Endif
  
End

Private Function Name_Read() As String
  
  Return $name
  
End

Private Sub Name_Write(Value As String)
  
  $name = Value
  
End

Private Function Action_Read() As String[]
  
  Return $Action
  
End

Private Sub Action_Write(Value As String[])
  
  $Action = Value
  
End

Private Function CheckID_Read() As Boolean
  
  Return $checkID
  
End

Private Function keyWordList_Read() As String[]
  
  Return $keywordList
  
End

Private Function Active_Read() As Boolean
  
  Return $Active
  
End

Public Function Toggle()
  
  $Active = Not $Active
  
End
